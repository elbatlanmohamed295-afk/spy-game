<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¨Ù†ÙŠ Ø£Ø¯Ù…ÙŠÙ† ÙˆØ¨Ø±Øµ ğŸ¦ PRO</title>
    <link rel="icon" href="/logo.png" type="image/png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Cairo', sans-serif; background: #0f0f0f; color: #fff; margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 450px; background: #1a1a1a; padding: 25px; border-radius: 30px; border: 1px solid #333; box-shadow: 0 20px 50px rgba(0,0,0,0.8); }
        h1 { color: #ffd700; text-shadow: 0 0 10px rgba(255,215,0,0.3); }
        select, input, button { width: 100%; padding: 15px; margin-bottom: 15px; border-radius: 15px; border: none; font-family: 'Cairo'; font-size: 16px; transition: 0.2s; }
        input, select { background: #2a2a2a; color: #fff; }
        button { font-weight: 900; cursor: pointer; }
        button:active { transform: scale(0.95); }
        .btn-join { background: #ffd700; color: #000; }
        .btn-start { background: #2ecc71; color: #fff; }
        .btn-reveal { background: #ff4757; color: #fff; }
        .shout-box { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .btn-shout { background: #333; color: #ffd700; font-size: 12px; padding: 8px; margin: 0; }
        .player-img { width: 50px; height: 50px; border-radius: 50%; border: 2px solid #ffd700; object-fit: cover; }
        .card { background: #fff; color: #000; padding: 30px; border-radius: 25px; margin-top: 20px; animation: slideUp 0.4s ease; }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        #toast { position: fixed; top: 20px; right: 20px; background: #ffd700; color: #000; padding: 10px 20px; border-radius: 10px; display: none; z-index: 1000; font-weight: bold; }
        #lobby, #gameArea, #resultArea { display: none; }
    </style>
</head>
<body>
    <div id="toast"></div>
    <div class="container">
        <h1>ğŸ¦ Ø¨Ù†ÙŠ Ø£Ø¯Ù…ÙŠÙ† ÙˆØ¨Ø±Øµ</h1>
        <div id="loginArea">
            <select id="userSelect">
                <option value="" disabled selected>ğŸ‘¤ Ù…ÙŠÙ† Ø­Ø¶Ø±ØªÙƒØŸ</option>
                <option value="Ù…Ø­Ù…Ø¯ Ø±Ù…Ø¶Ø§Ù†">Ù…Ø­Ù…Ø¯ Ø±Ù…Ø¶Ø§Ù†</option><option value="Ø£Ø­Ù…Ø¯ Ø­Ù…Ø¯ÙŠ">Ø£Ø­Ù…Ø¯ Ø­Ù…Ø¯ÙŠ</option>
                <option value="Ø£Ù…ÙŠÙ† Ù…Ø­Ù…Ø¯">Ø£Ù…ÙŠÙ† Ù…Ø­Ù…Ø¯</option><option value="Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… Ù…Ø­Ù…ÙˆØ¯">Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… Ù…Ø­Ù…ÙˆØ¯</option>
                <option value="Ø¶ÙŠÙ Ø¬Ø¯ÙŠØ¯">âœ¨ Ø¶ÙŠÙ Ø¬Ø¯ÙŠØ¯</option>
            </select>
            <input type="text" id="customName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ" style="display:none;">
            <input type="number" id="room" placeholder="Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©" value="777">
            <button class="btn-join" onclick="join()">ÙŠØ§Ù„Ø§ Ø¨ÙŠÙ†Ø§ ğŸš€</button>
        </div>

        <div id="lobby">
            <div style="display:flex; justify-content:space-between;"><span>Ø§Ù„ØºØ±ÙØ©: <b id="rId"></b></span><span>Ø§Ù„Ø¹Ø¯Ø¯: <b id="count">0</b></span></div>
            <select id="cat"><option>Ø£Ù…Ø§ÙƒÙ† ğŸŒ</option><option>Ø£ÙƒÙ„Ø§Øª ğŸ¥˜</option><option>Ù…Ø´Ø§Ù‡ÙŠØ± ğŸŒŸ</option></select>
            <div id="pList" style="margin:20px 0;"></div>
            <button class="btn-start" onclick="start()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¬ÙŠÙ… ğŸ”¥</button>
        </div>

        <div id="gameArea">
            <div class="card"><h3 id="role"></h3><h1 id="item" style="font-size:3em;"></h1></div>
            <button id="revBtn" class="btn-reveal" onclick="vote()">ğŸš¨ ÙƒØ´Ù Ø§Ù„Ø¬Ø§Ø³ÙˆØ³</button>
            <p id="vStat" style="display:none;">Ø§Ù„Ø£ØµÙˆØ§Øª: <span id="vCount">0</span></p>
            <div class="shout-box">
                <button class="btn-shout" onclick="shout('Ø´Ø§ÙƒÙƒ ÙÙŠÙƒ! ğŸ‘€')">Ø´Ø§ÙƒÙƒ ÙÙŠÙƒ! ğŸ‘€</button>
                <button class="btn-shout" onclick="shout('ÙˆØ§Ù„Ù„Ù‡ Ù…ÙˆØ§Ø·Ù† ğŸ‘·')">ÙˆØ§Ù„Ù„Ù‡ Ù…ÙˆØ§Ø·Ù† ğŸ‘·</button>
                <button class="btn-shout" onclick="shout('Ø§Ù„Ø¨Ø±Øµ Ø¨Ø§Ù† Ø®Ù„Ø§Øµ ğŸ˜‚')">Ø§Ù„Ø¨Ø±Øµ Ø¨Ø§Ù† Ø®Ù„Ø§Øµ ğŸ˜‚</button>
                <button class="btn-shout" onclick="shout('Ø¨ØµÙˆØ§ Ù„Ø¨Ø¹Ø¶ ÙƒØ¯Ø© ğŸ§')">Ø¨ØµÙˆØ§ Ù„Ø¨Ø¹Ø¶ ÙƒØ¯Ø© ğŸ§</button>
            </div>
        </div>

        <div id="resultArea">
            <h2 style="color:#ff4757;">Ù‚ÙØ´Ù†Ø§ Ø§Ù„Ø¨Ø±Øµ! ğŸ¦</h2>
            <img id="spyImg" src="" style="width:120px; height:120px; border-radius:50%; border:5px solid #ff4757;">
            <h2 id="spyName"></h2>
            <div style="background:#ff4757; padding:15px; border-radius:15px; margin:15px 0;"><b>Ø§Ù„Ø¹Ù‚Ø§Ø¨:</b> <span id="pun"></span></div>
            <button class="btn-join" onclick="reset()">ğŸ”„ Ø¯ÙˆØ± ÙƒÙ…Ø§Ù†</button>
        </div>
    </div>

    <script>
        const socket = io(), imgs = {"Ù…Ø­Ù…Ø¯ Ø±Ù…Ø¶Ø§Ù†":"1.jpeg","Ø£Ø­Ù…Ø¯ Ø­Ù…Ø¯ÙŠ":"2.jpeg","Ø£Ù…ÙŠÙ† Ù…Ø­Ù…Ø¯":"3.jpeg","Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… Ù…Ø­Ù…ÙˆØ¯":"4.jpeg","default":"/logo.png"};
        let me = '', rm = '';

        document.getElementById('userSelect').onchange = function(){ document.getElementById('customName').style.display = (this.value==='Ø¶ÙŠÙ Ø¬Ø¯ÙŠØ¯'?'block':'none'); };

        function join(){
            me = (document.getElementById('userSelect').value==='Ø¶ÙŠÙ Ø¬Ø¯ÙŠØ¯') ? document.getElementById('customName').value : document.getElementById('userSelect').value;
            rm = document.getElementById('room').value;
            if(!me || !rm) return;
            socket.emit('join', {username: me, room: rm, userImg: imgs[document.getElementById('userSelect').value] || imgs.default});
            document.getElementById('loginArea').style.display='none'; document.getElementById('lobby').style.display='block'; document.getElementById('rId').innerText=rm;
        }

        function start(){ socket.emit('start_game', {room: rm, category: document.getElementById('cat').value}); }
        function vote(){ document.getElementById('revBtn').disabled=true; socket.emit('request_reveal', {room: rm}); }
        function shout(m){ socket.emit('send_shout', {room: rm, user: me, msg: m}); }
        function reset(){ socket.emit('reset_game', {room: rm}); }

        socket.on('update_player_list', d => {
            document.getElementById('count').innerText=d.count;
            document.getElementById('pList').innerHTML = d.players.map(p => `<div style="display:flex; align-items:center; gap:10px; background:#2a2a2a; padding:10px; border-radius:10px; margin-bottom:5px;"><img src="${p.img}" class="player-img"><b>${p.name}</b></div>`).join('');
        });

        socket.on('game_started', d => {
            document.getElementById('lobby').style.display='none'; document.getElementById('resultArea').style.display='none'; document.getElementById('gameArea').style.display='block';
            document.getElementById('role').innerText = d.role; document.getElementById('item').innerText = d.item;
            document.getElementById('role').style.color = d.is_spy ? '#ff4757' : '#2ecc71';
            if(d.is_spy && window.navigator.vibrate) window.navigator.vibrate([200, 100, 200]);
        });

        socket.on('vote_update', d => { document.getElementById('vStat').style.display='block'; document.getElementById('vCount').innerText = `${d.current}/${d.total}`; });
        
        socket.on('receive_shout', d => {
            const t = document.getElementById('toast'); t.innerText = `${d.user}: ${d.msg}`; t.style.display='block';
            setTimeout(()=> t.style.display='none', 3000);
        });

        socket.on('show_result', d => {
            document.getElementById('gameArea').style.display='none'; document.getElementById('resultArea').style.display='block';
            document.getElementById('spyName').innerText = d.spy; document.getElementById('pun').innerText = d.punishment;
            document.getElementById('spyImg').src = imgs[d.spy] || imgs.default;
        });

        socket.on('reset_view', () => { document.getElementById('resultArea').style.display='none'; document.getElementById('lobby').style.display='block'; document.getElementById('revBtn').disabled=false; document.getElementById('vStat').style.display='none'; });
    </script>
</body>
</html>
